##[sample("opa-gatekeeper")]

policy require_owner_label {
  target = "admission.k8s.gatekeeper.sh"
  kind = "K8sRequiredLabels"
  match = { kinds = ["Pod","Deployment"] }
  parameters = { labels = ["owner","team"] }
  rego = @'''
    package kubernetes.admission
    deny[msg] {
      input.review.object.metadata.labels["owner"] == null
      msg := "owner label is required"
    }
  '''
}
